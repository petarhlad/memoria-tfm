\chapter{Multiple use: Anonymity and Non-traceability}
To achieve full anonymity we need some 
Multiple use 


\section{Linear size anonymous threshold signature}
\cite{DazaDSV09}

Based on Shamir's secret sharing scheme, this will set a $(t,n)$-threshold secret sharing scheme.

Setup Algorithm

Let $\PP = \{P_1 , \dots , P_n \}$ be the set of participants.

The set of participants is divided into $r$ groups $\PP_1, \dots , \PP_r$, with each group consisting of $n/r$ participants ($\PP_i = \{P^i_1, \dots , P^i_{n/r}\}$). For simplicity, we assume that $r \vert n$.

Let $q > n$ be a sufficiently large prime. Let $a_0, \dots , a_{t-1} \in_R \ZZ_q$, where $s=a_0 \in \ZZ_q$ is the secret key.

We set up a $(t,r)$-threshold signature scheme.

When $t$ participants try to sign a message, there is a probability $p_{\text{fail}} = 1 - p_{\text{success}}$ that at least two participants belong to the same group. The probability that all $t$ participants belong to different groups is given by $p_{\text{success}} = \frac{\binom{r}{t} \left( \frac{n}{r} \right)^{t}}{\binom{n}{t}}$.

Looks like, for large values, $p_{\text{fail}} \sim \frac{t^2}{2r}$

In \cite{DazaDSV09} they extend this scheme in the following way: There are set $d$ different $(t,r)$-threshold signature scheme and every participant is given $d$ shares, one for each secret. The probability of not being able to sign a message is $\left(p_{\text{fail}} \right)^d$.

To be anonymous, we need $n \geq 2r$.

\section{Non-linear size anonymous threshold signature}
\cite{ChenNW11}
Setup Algorithm

$G_1$, $G_2$, $G_T$ of sufficiently large prime order $q$. Two random generators $g_1 \in G_1$, $g_2 \in G_2$, and a bilinear pairing $\hat{t}: G_1 \times G_2 \rightarrow G_T$.

DDH problem in $G_1$, Gap-DL problem in $G_1$ and $G_2$ and the blind bilinear LRSW problem are hard.

Let $H_0 : \{0,1\}^\ast \rightarrow \ZZ_q$ and $H_1 : \{ 0 , 1 \}^\ast \rightarrow G_1$ be two hash functions.

For each issuer $i \in \mathcal{I}$ the following is performed.

Two integers are selected $x,y \in_R \ZZ_q$ and the issuer secret key \textbf{isk} is assigned to be $(x,y)$. Then the values $X = g_2^{x} \in G_2$ and $Y = g_2^{y} \in G_2$ are computed. The issuer public key \textbf{ipk} is assigned to be $(X,Y)$.

Finally the system public parameters $par$ are set to be $(G_1, G_2, G_T, \hat{t}, g_1, g_2, H_0, H_1, \text{ipk
}_k)$ and are published.

Join protocol

This is a protocol between a given signer $s \in S$  and an issuer $i \in \mathcal{I}$.


(Maybe could be a random $f \in G_1$)
The signer generates a secret value $f$ using its internal seed \textbf{TAAseed}, along with the value \textbf{K}\textsubscript{I} provided by $i$ and a count number \textbf{cnt}.

\begin{figure}[H]
$$
\begin{array}{ccc}
    \text{Signer}(\mathfrak{s}) &    & \text{Issuer}(\mathfrak{i}) \\
    \hline
    \\
    f \in_R \ZZ_q, \ F = g_1^f &    &    \\
    \text{str} \leftarrow X \parallel Y \parallel n_I &  \xleftarrow{\text{comm}_{\text{req}}} & \text{comm}_{\text{req}} \leftarrow n_I \\
        & \longrightarrow & \text{If } F = g_1^{f_i} \text{ for any } f_i \text{ on the roge list then \textbf{abort}} \\
        &        & r\in_R \ZZ_q; \ A = g_1^r; \ B = A^y \\
    \text{If } \hat{t}(A,Y) \neq \hat{t}(B,g_2) & \xleftarrow{\text{  cre  }} & C = (A^x \cdot F^{rxy}); \ cre \leftarrow(A,B,C) \\
    \text{or } \hat{t}(A \cdot B^f , X) \neq \hat{t}(C,g_2) &    & \\
    \text{then \textbf{abort}} &    & \\
    \hline
\end{array} 
$$
\caption{The Join Protocol}
\label{fig:join}
\end{figure}

\begin{figure}[H]
$$\begin{array}{l}
\text{Signer}(\mathfrak{s}) \\
\hline
\text{Input: } f \in \ZZ_q; \ n_T \leftarrow \{0,1\}^\ast; \ msg \\
a \in_R \ZZ_q; \ z \in_R \ZZ_q \\
J \leftarrow H_1(\text{msgt}); \ K = J^f; \ L = J^z \\
R = A^a; \ S = B^a; \ T = C^a; \ \tau = \hat{t}(S,X)^z \\
c \leftarrow H_0(R \parallel S \parallel T \parallel \tau \parallel J \parallel K \parallel L \parallel n_T \parallel \text{msgb}) \\
s \leftarrow z + c \cdot f \mod q \\
\sigma \leftarrow (R,S,T,J,K,c,s,n_T) \\
\text{Output: } \sigma \\
\hline
\end{array}
$$
\caption{The Sign Algorithm}
\label{fig:sign}
\end{figure}

\begin{figure}[H]
$$\begin{array}{l}
\text{Verifier}(\mathfrak{v}) \\
\hline
\text{Input: \textbf{ipk}}_k = (X,Y); \ \text{msg} = (\text{msgt}, \text{msgb}) \\
\sigma = (R,S,T,J,K,c,s,n_T) \\
\text{If } K = J^{f_i}, \text{ for any } f_i \text{in the set of rogue secret keys, or} \\
\qquad \hat{t}(R,Y) \neq \hat{t}(S,g_2), \text{ or} \\
\qquad J \neq H_1(\text{msgt}) \text{ return \textbf{reject}} \\
\rho_a^\dagger = \hat{t}(R,X); \rho_b^\dagger = \hat{t}(S,X); \rho_c^\dagger = \hat{t}(T,g_2) \\
\tau^\dagger = (\rho_b^\dagger)^s \cdot (\rho_c^\dagger / \rho_a^\dagger)^{-c} \\
L^\dagger = J^s \cdot K^{-c} \\
\text{If } c \neq H_0 (R \con S \con T \con \tau^\dagger \con J \con K \con L^\dagger \con n_T \con \text{msgb}) \text{ return \textbf{reject}} \\
\text{Otherwise return \textbf{accept}} \\
\hline
\end{array}
$$
\caption{The Verify Algorithm}
\label{fig:verify}
\end{figure}

In the Sign Algorithm (Fig. \ref{fig:sign}), the computation of $L$, $c$ and $s$ is for the non-interactive Zero-knowledge proof of knowledge of $f$, and $\tau$ is to proof the knowledge of the issuer's credentials. This is based on the \textit{Schnorr protocol} described in \cite{Schnorr90}

To see if two signatures with same message title were signed by the same signer, only have to check whether $J_0 = J_1$ and $K_0 = K_1$.

In the case of using this scheme in a polling system, \textbf{msgt} could be used to identify the poll and \textbf{msgb} for the poll choice.

\section{Anonymous interactive protocol}

We propose an interactive protocol based on the signature scheme described in section \ref{sec:shamir_sig}. Recall that this scheme does not have the \textit{unlinkability} property because it uses "pseudonyms" and they are shared to compute the signature. So, the idea of this new protocol is to hide the "pseudonyms".

As in the previous scheme, a participant $P_i$ from a subset $P \subset \PP$ of $t$ participants will compute a partial signature $\sigma_i (m)$ on a message $m$.

In the following description, the partial signature will be $\sigma_i (m) = H(m)^{s_i \prod_{P_j \in (P \setminus P_i)} \frac{-\alpha_j}{\alpha_i - \alpha_j}}$. So the goal of this improvement is to compute $a^\frac{-\alpha_j}{\alpha_i - \alpha_j}$, for $1 \neq a \in G$, and a given participant $P_j \in P$ without sharing the values of $\alpha_i$ and $\alpha_j$. The protocol needs $t^2$ interactions as the one described in figure \ref{fig:proposed_protocol} to be able to compute the whole signature.

To compute $a^\frac{-\alpha_j}{\alpha_i - \alpha_j}$ we need participants $P_i,P_j$ and any other third participant $P_k$.

$P_i$ chooses $x_i, x_j, x_k \in \ZZ^*_p$ three random values and shares them with $P_j$ and $P_k$.

$P_i$ and $P_j$ randomly choose linear polynomials $f_i, g_i$ and $f_j, g_j$, respectively, where the values of $\alpha_i$ and $\alpha_j$ are hidden in $f_i$ and $f_j$, respectively. As they share with each other the values of the polynomials on respective values $x_i, x_j, x_k$, each can compute the value of the quadratic polynomial $(g_i+g_j) \cdot (f_i - f_j)$ on a certain value and share it with $P_i$. Then, $P_i$ can compute the constant term of the quadratic polynomial $v \cdot (\alpha_i - \alpha_j)$ for some $v \in \ZZ_p$.

Now, $P_i$ computes $A := a^{\frac{1}{v(\alpha_i - \alpha_j)}}$ and shares it with $P_j$. They compute $A^{(g_i + g_j)(x_i)}$ and $A^{(g_i + g_j)(x_j)}$, resp., and they share it. With the values $x_i, x_j$; $P_j$ can do exponent interpolation and get $ a^{\frac{(g_i + g_j)(0)}{v(\alpha_i - \alpha_j)}} = a^{\frac{v}{v(\alpha_i - \alpha_j)}} = a^{\frac{1}{\alpha_i - \alpha_j}}$, and finally compute $a^{\frac{-\alpha_j}{\alpha_i - \alpha_j}}$

% Once it is clear how can $P_i$ get $a^{\frac{1}{\alpha_j - \alpha_i}}$ for any $1 \neq a \in G$ (?).
Let $\{ P_{j_1}, \dots , P_{j_{t-1}} \} = P \setminus P_i$, and let $a_k =  a_{k-1} {}^{\frac{- \alpha_{j_{k-1}}}{\alpha_{i} - \alpha_{j_{k-1}}}}$, where $a_1 = H(m)^{s_i}$. To compute the partial signature on $m$, $P_i$ interacts with each $P_{j_k}$ to compute $a_k^{\frac{-\alpha_k}{\alpha_i - \alpha_k}}$. Finally, we have:
$$
\sigma_i (m)
= a_{t-1} {}^{\frac{- \alpha_{j_{t-1}}}{\alpha_{i} - \alpha_{j_{t-1}}}}
= a_k {}^{\frac{- \alpha_{j_{k}}}{\alpha_{i} - \alpha_{j_{k}}} \cdots \frac{- \alpha_{j_{t-1}}}{\alpha_{i} - \alpha_{j_{t-1}}}}
= a_1 {}^{\frac{- \alpha_{j_{1}}}{\alpha_{i} - \alpha_{j_{1}}} \cdots \frac{- \alpha_{j_{t-1}}}{\alpha_{i} - \alpha_{j_{t-1}}}}
= H(m)^{ s_i \frac{- \alpha_{j_{1}}}{\alpha_{i} - \alpha_{j_{1}}} \cdots \frac{- \alpha_{j_{t-1}}}{\alpha_{i} - \alpha_{j_{t-1}}}}
$$

\begin{figure}[H]
\tiny
$$
\begin{array}{lllll}
    P_i    &        & P_j    &        & P_k    \\
    \hline
    \\
    
    \text{Input: } a \in G 
            &        &        &        &        \\
    \\

    x_i, x_j, x_k \in_R \ZZ_p \setminus \{0\}
            & \xrightarrow{\makebox[1.5cm]{$x_i,x_j,x_k$}}    &        &        &        \\
            & \multicolumn{3}{l}{\xrightarrow{\makebox[7.5cm]{$x_i,x_j,x_k$}}}  &        \\
    \\
                
    \gamma_{i,0}, \gamma_{i,1}, \gamma_{i,2} \in_R \ZZ_p
            &        & \gamma_{j,0}, \gamma_{j,1}, \gamma_{j,2} \in_R \ZZ_p
                             &        &        \\
    \gamma_{i,1}, \gamma_{i,2} \neq 0
            &        & \gamma_{j,1}, \gamma_{j,2} \neq 0
                             &        &        \\
    \\
    g_i(x) \leftarrow \gamma_{i,1} \cdot x + \gamma_{i,0}
            &        & g_j(x) \leftarrow \gamma_{j,1} \cdot x + \gamma_{j,0}
                             &        &        \\
    f_i(x) \leftarrow \gamma_{i,2} \cdot x + \alpha_i
            &        & f_j(x) \leftarrow \gamma_{j,2} \cdot x + \alpha_j
                             &        &        \\
    \\
    
    g_i(x_j), f_i(x_j)
            & \xrightarrow{g_i(x_j), f_i(x_j)}
                     &        &        &        \\
    g_i(x_k), f_i(x_k)
            & \multicolumn{3}{l}{\xrightarrow{\makebox[7.5cm]{$g_i(x_k), f_i(x_k)$}}} &        \\
    \\
    
            & \xleftarrow{\makebox[1.5cm]{$g_j(x_i), f_j(x_i)$}}
                     & g_j(x_i), f_j(x_i)
                              &        &        \\
            &        & g_j(x_k), f_j(x_k)
                              & \xrightarrow{\makebox[1.5cm]{$g_j(x_k), f_j(x_k)$}}
                                       &        \\
    
    h_i \leftarrow \left((g_i+g_j)(f_i - f_j)\right)(x_i)
            &        &        &        &        \\
            
            & \xleftarrow{\makebox[1.5cm]{$h_j$}}
                     & h_j \leftarrow \left((g_i+g_j)(f_i - f_j)\right)(x_j)
                              &        &        \\
    \\
    
            & \multicolumn{3}{l}{\xleftarrow{\makebox[7.5cm]{$h_k$}}}
                                       & h_k \leftarrow \left((g_i+g_j)(f_i - f_j)\right)(x_k) \\
    v(\alpha_i - \alpha_j) := 
            &        &        &        &        \\
    \quad (\gamma_{i,0} + \gamma_{j,0})(\alpha_i - \alpha_j) \leftarrow h_i,h_j,h_k
            &        &        &        &        \\
    \\
    A \leftarrow a^{\frac{1}{v(\alpha_i - \alpha_j)}}
            &       &        &        &        \\
    A^{G_i} \leftarrow A^{g_i(x_i)+g_j(x_i)}    
            & \xrightarrow{\makebox[1.5cm]{$A, A^{G_i}$}}
                    & A^{G_j} \leftarrow A^{g_i(x_j)+g_j(x_j)}
                             &        &        \\
    \\
            &        &
                            \multicolumn{2}{l}{A^{G_i\frac{-x_j}{x_i - x_j}} A^{G_j\frac{-x_i}{x_j - x_i}} = A^{g_i(0) + g_j(0)} = }
                                       &        \\
                            
    a^{\frac{-\alpha_j}{\alpha_i - \alpha_j}}
            & \xleftarrow{\makebox[1.5cm]{$a^{\frac{-\alpha_j}{\alpha_i - \alpha_j}}$}}
                     & \multicolumn{2}{l}{a^{\frac{v}{v(\alpha_i - \alpha_j)}} = a^{\frac{1}{\alpha_i - \alpha_j}}}
                                       &        \\
    \\
    \text{Output: } a^{\frac{-\alpha_j}{\alpha_i - \alpha_j}}
            &        &        &        &        \\
    \hline
\end{array} 
$$
\normalsize
\caption{The Proposed Protocol}
\label{fig:proposed_protocol}
\end{figure}